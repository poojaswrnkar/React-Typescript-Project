 # name: SonarQube Integration

# on:
#   pull_request:
#     branches:
#       - main
#       - develop

# jobs:
#   sonarqube:
#     name: SonarQube Integration
#     runs-on: ubuntu-latest
    
#     steps:
#     - name: Checkout code
#       uses: actions/checkout@v2
#       with:
#         # Disabling shallow clone is recommended for improving relevancy of reporting
#         fetch-depth: 0

#     - name: Set up JDK 11
#       uses: actions/setup-java@v2
#       with:
#         java-version: 11

#     - name: Cache SonarQube packages
#       uses: actions/cache@v2
#       with:
#         path: ~/.sonar/cache
#         key: ${{ runner.os }}-sonar-${{ hashFiles('**/*.gradle*', '**/*.java*') }}
#         restore-keys: ${{ runner.os }}-sonar

#     - name: Cache Gradle packages
#       uses: actions/cache@v2
#       with:
#         path: ~/.gradle/caches
#         key: ${{ runner.os }}-gradle-${{ hashFiles('**/*.gradle*', '**/*.java*') }}
#         restore-keys: ${{ runner.os }}-gradle

#     - name: Grant execute permission for gradlew
#       run: chmod +x gradlew

#     - name: Build with Gradle
#       run: ./gradlew build

#     - name: SonarQube Scan
#       uses: sonarsource/sonarqube-scan-action@master
#       env:
#         SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
#         SONAR_HOST_URL: ${{ secrets.SONAR_HOST_URL }}
#       run: |
#         npm install -g sonarqube-scanner
#         sonar-scanner -X \  # Enable debug logging
#           -Dsonar.projectKey=Static-code-analysis \
#           -Dsonar.organization=Static-code-analysis \
#           -Dsonar.host.url=${{ secrets.SONAR_HOST_URL }} \
#           -Dsonar.login=${{ secrets.SONAR_TOKEN }}



name: SonarQube Integration

on:
  pull_request:
    branches:
      - main
      - develop

jobs:
  build:
    name: Build and SonarQube Analysis
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2
      with:
        fetch-depth: 0

    - name: Set up Java
      uses: actions/setup-java@v2
      with:
        java-version: '11'  # or a version compatible with SonarScanner

    - name: Set up Node.js
      uses: actions/setup-node@v2
      with:
        node-version: '16'

    - name: Cache node modules
      uses: actions/cache@v2
      with:
        path: ~/.npm
        key: ${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }}
        restore-keys: |
          ${{ runner.os }}-node-

    - name: Install dependencies
      run: npm install

    - name: Install SonarQube Scanner
      run: npm install -g sonarqube-scanner

    - name: SonarQube Scan
      env:
        SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
        SONAR_HOST_URL: ${{ secrets.SONAR_HOST_URL }}
      run: |  
        sonar-scanner -X \
          -Dsonar.projectKey=Static-code-analysis \
          -Dsonar.organization=Static-code-analysis \
          -Dsonar.host.url=${{ secrets.SONAR_HOST_URL }} \
          -Dsonar.login=${{ secrets.SONAR_TOKEN }}

